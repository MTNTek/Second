"use strict";(()=>{var e={};e.id=998,e.ids=[998],e.modules={5890:e=>{e.exports=require("better-sqlite3")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2048:e=>{e.exports=require("fs")},8216:e=>{e.exports=require("net")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6119:e=>{e.exports=require("perf_hooks")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},1764:e=>{e.exports=require("util")},6005:e=>{e.exports=require("node:crypto")},4709:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>g,routeModule:()=>L,serverHooks:()=>h,staticGenerationAsyncStorage:()=>A});var n={};a.r(n),a.d(n,{GET:()=>N,POST:()=>_});var l=a(9303),r=a(8716),o=a(670),i=a(7070);let s=require("fs/promises");var u=a(2048),d=a(5315),p=a(5748),c=a(7327),f=a(8695),m=a(7745);let y=["image/jpeg","image/png","image/webp","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];async function _(e){try{let t=(0,f.AY)(e);if(!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let a=await e.formData(),n=a.get("file"),l=a.get("applicationId"),r=a.get("applicationType"),o=a.get("documentType");if(!n)return i.NextResponse.json({error:"No file provided"},{status:400});if(n.size>5242880)return i.NextResponse.json({error:"File size too large. Maximum size is 5MB"},{status:400});if(!y.includes(n.type))return i.NextResponse.json({error:"Invalid file type. Allowed types: JPEG, PNG, WebP, PDF, DOC, DOCX"},{status:400});if(!l||!r)return i.NextResponse.json({error:"Application ID and type are required"},{status:400});let m=(0,d.join)(process.cwd(),"uploads",r);(0,u.existsSync)(m)||await (0,s.mkdir)(m,{recursive:!0});let _=Date.now(),N=n.name.split(".").pop(),L=`${l}_${_}.${N}`,g=(0,d.join)(m,L),A=await n.arrayBuffer(),h=Buffer.from(A);await (0,s.writeFile)(g,h);let v=await p.db.insert(c.fileUploads).values({userId:t.userId,applicationId:l,applicationType:r,fileName:L,originalName:n.name,fileSize:n.size,mimeType:n.type,fileUrl:`/uploads/${r}/${L}`,documentType:o}).returning();return i.NextResponse.json({message:"File uploaded successfully",file:v[0]})}catch(e){return console.error("File upload error:",e),i.NextResponse.json({error:"Failed to upload file"},{status:500})}}async function N(e){try{let t;let a=(0,f.AY)(e);if(!a)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:n}=new URL(e.url),l=n.get("applicationId"),r=n.get("applicationType");return t=l&&r?await p.db.select().from(c.fileUploads).where((0,m.eq)(c.fileUploads.applicationId,l)):await p.db.select().from(c.fileUploads).where((0,m.eq)(c.fileUploads.userId,a.userId)),i.NextResponse.json({files:t})}catch(e){return console.error("Get files error:",e),i.NextResponse.json({error:"Failed to fetch files"},{status:500})}}let L=new l.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"C:\\dev\\Second\\app\\api\\upload\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:A,serverHooks:h}=L,v="/api/upload/route";function w(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:A})}},5748:(e,t,a)=>{let n;a.d(t,{db:()=>n});var l=a(6571),r=a(6596),o=a(8937),i=a(5890),s=a.n(i),u=a(7327),d=a(5315),p=a.n(d),c=a(2048),f=a.n(c);let m=process.env.DATABASE_URL;if(m&&"postgresql://username:password@localhost:5432/perry_eden_db"!==m&&!m.includes("[PASSWORD]")&&!m.includes("[PROJECT-REF]")&&m.startsWith("postgresql://")){let e=(0,o.Z)(m,{prepare:!1});n=(0,l.t)(e,{schema:u})}else{let e=p().join(process.cwd(),"data"),t=p().join(e,"development.db");f().existsSync(t)||(console.warn("⚠️ Development database not found. Please run: npm run db:init"),f().existsSync(e)||f().mkdirSync(e,{recursive:!0}));let a=new(s())(t);n=(0,r.t)(a)}},7327:(e,t,a)=>{a.r(t),a.d(t,{applicationStatusEnum:()=>f,contactSubmissions:()=>b,documentServices:()=>h,fileUploads:()=>w,notifications:()=>x,paymentStatusEnum:()=>m,payments:()=>v,serviceTypeEnum:()=>y,travelBookings:()=>N,uaeJobApplications:()=>A,userRoleEnum:()=>c,users:()=>_,visaApplications:()=>L,workPermitApplications:()=>g});var n=a(5396),l=a(889),r=a(2140),o=a(8748),i=a(1575),s=a(1401),u=a(2941),d=a(3050),p=a(450);let c=(0,n.ys)("user_role",["admin","user","agent"]),f=(0,n.ys)("application_status",["pending","in_progress","approved","rejected","completed"]),m=(0,n.ys)("payment_status",["pending","processing","completed","failed","refunded"]),y=(0,n.ys)("service_type",["travel","visa","work_permit","document","uae_job"]),_=(0,l.af)("users",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,p.Mc)()),email:(0,r.fL)("email").unique().notNull(),password:(0,r.fL)("password"),name:(0,r.fL)("name").notNull(),phone:(0,r.fL)("phone"),role:c("role").default("user").notNull(),isVerified:(0,o.O7)("is_verified").default(!1),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()}),N=(0,l.af)("travel_bookings",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,p.Mc)()),userId:(0,r.fL)("user_id").references(()=>_.id),bookingType:(0,s.L7)("booking_type",{length:50}).notNull(),departure:(0,r.fL)("departure"),destination:(0,r.fL)("destination"),departureDate:(0,i.AB)("departure_date"),returnDate:(0,i.AB)("return_date"),passengers:(0,u._L)("passengers").default(1),rooms:(0,u._L)("rooms").default(1),classType:(0,s.L7)("class_type",{length:20}),totalAmount:(0,d.gH)("total_amount",{precision:10,scale:2}),currency:(0,s.L7)("currency",{length:3}).default("AED"),status:f("status").default("pending").notNull(),specialRequests:(0,r.fL)("special_requests"),contactName:(0,r.fL)("contact_name").notNull(),contactEmail:(0,r.fL)("contact_email").notNull(),contactPhone:(0,r.fL)("contact_phone").notNull(),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()}),L=(0,l.af)("visa_applications",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,p.Mc)()),userId:(0,r.fL)("user_id").references(()=>_.id),visaType:(0,s.L7)("visa_type",{length:50}).notNull(),nationality:(0,r.fL)("nationality").notNull(),passportNumber:(0,r.fL)("passport_number").notNull(),passportExpiry:(0,i.AB)("passport_expiry").notNull(),purposeOfVisit:(0,s.L7)("purpose_of_visit",{length:50}).notNull(),intendedArrival:(0,i.AB)("intended_arrival"),duration:(0,u._L)("duration"),totalAmount:(0,d.gH)("total_amount",{precision:10,scale:2}),currency:(0,s.L7)("currency",{length:3}).default("AED"),status:f("status").default("pending").notNull(),processingDays:(0,u._L)("processing_days"),additionalNotes:(0,r.fL)("additional_notes"),contactName:(0,r.fL)("contact_name").notNull(),contactEmail:(0,r.fL)("contact_email").notNull(),contactPhone:(0,r.fL)("contact_phone").notNull(),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()}),g=(0,l.af)("work_permit_applications",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,p.Mc)()),userId:(0,r.fL)("user_id").references(()=>_.id),country:(0,s.L7)("country",{length:50}).notNull(),jobTitle:(0,r.fL)("job_title").notNull(),company:(0,r.fL)("company"),salary:(0,d.gH)("salary",{precision:10,scale:2}),currency:(0,s.L7)("currency",{length:3}).default("EUR"),location:(0,r.fL)("location"),workExperience:(0,r.fL)("work_experience"),education:(0,r.fL)("education"),languageSkills:(0,r.fL)("language_skills"),status:f("status").default("pending").notNull(),processingWeeks:(0,u._L)("processing_weeks"),accommodationIncluded:(0,o.O7)("accommodation_included").default(!1),transportIncluded:(0,o.O7)("transport_included").default(!1),contactName:(0,r.fL)("contact_name").notNull(),contactEmail:(0,r.fL)("contact_email").notNull(),contactPhone:(0,r.fL)("contact_phone").notNull(),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()}),A=(0,l.af)("uae_job_applications",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,p.Mc)()),userId:(0,r.fL)("user_id").references(()=>_.id),industry:(0,s.L7)("industry",{length:50}).notNull(),jobTitle:(0,r.fL)("job_title").notNull(),experience:(0,s.L7)("experience",{length:20}),expectedSalary:(0,d.gH)("expected_salary",{precision:10,scale:2}),currency:(0,s.L7)("currency",{length:3}).default("AED"),availability:(0,i.AB)("availability"),visaStatus:(0,s.L7)("visa_status",{length:50}),resume:(0,r.fL)("resume_url"),status:f("status").default("pending").notNull(),contactName:(0,r.fL)("contact_name").notNull(),contactEmail:(0,r.fL)("contact_email").notNull(),contactPhone:(0,r.fL)("contact_phone").notNull(),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()}),h=(0,l.af)("document_services",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,p.Mc)()),userId:(0,r.fL)("user_id").references(()=>_.id),serviceType:(0,s.L7)("service_type",{length:50}).notNull(),documentType:(0,r.fL)("document_type").notNull(),language:(0,s.L7)("language",{length:20}),urgency:(0,s.L7)("urgency",{length:20}),quantity:(0,u._L)("quantity").default(1),totalAmount:(0,d.gH)("total_amount",{precision:10,scale:2}),currency:(0,s.L7)("currency",{length:3}).default("AED"),status:f("status").default("pending").notNull(),deliveryMethod:(0,s.L7)("delivery_method",{length:20}),specialInstructions:(0,r.fL)("special_instructions"),contactName:(0,r.fL)("contact_name").notNull(),contactEmail:(0,r.fL)("contact_email").notNull(),contactPhone:(0,r.fL)("contact_phone").notNull(),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()}),v=(0,l.af)("payments",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,p.Mc)()),userId:(0,r.fL)("user_id").references(()=>_.id),applicationId:(0,r.fL)("application_id").notNull(),applicationType:y("application_type").notNull(),amount:(0,d.gH)("amount",{precision:10,scale:2}).notNull(),currency:(0,s.L7)("currency",{length:3}).notNull(),paymentMethod:(0,s.L7)("payment_method",{length:20}).notNull(),paymentGatewayId:(0,r.fL)("payment_gateway_id"),status:m("status").default("pending").notNull(),paidAt:(0,i.AB)("paid_at"),refundedAt:(0,i.AB)("refunded_at"),refundAmount:(0,d.gH)("refund_amount",{precision:10,scale:2}),metadata:(0,r.fL)("metadata"),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()}),w=(0,l.af)("file_uploads",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,p.Mc)()),userId:(0,r.fL)("user_id").references(()=>_.id),applicationId:(0,r.fL)("application_id").notNull(),applicationType:y("application_type").notNull(),fileName:(0,r.fL)("file_name").notNull(),originalName:(0,r.fL)("original_name").notNull(),fileSize:(0,u._L)("file_size").notNull(),mimeType:(0,r.fL)("mime_type").notNull(),fileUrl:(0,r.fL)("file_url").notNull(),documentType:(0,s.L7)("document_type",{length:50}),createdAt:(0,i.AB)("created_at").defaultNow().notNull()}),x=(0,l.af)("notifications",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,p.Mc)()),userId:(0,r.fL)("user_id").references(()=>_.id),title:(0,r.fL)("title").notNull(),message:(0,r.fL)("message").notNull(),type:(0,s.L7)("type",{length:20}).notNull(),applicationId:(0,r.fL)("application_id"),isRead:(0,o.O7)("is_read").default(!1),createdAt:(0,i.AB)("created_at").defaultNow().notNull()}),b=(0,l.af)("contact_submissions",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,p.Mc)()),name:(0,r.fL)("name").notNull(),email:(0,r.fL)("email").notNull(),phone:(0,r.fL)("phone"),subject:(0,r.fL)("subject").notNull(),message:(0,r.fL)("message").notNull(),service:(0,s.L7)("service",{length:50}),isReplied:(0,o.O7)("is_replied").default(!1),createdAt:(0,i.AB)("created_at").defaultNow().notNull()})},8695:(e,t,a)=>{a.d(t,{AY:()=>u,WX:()=>i,fT:()=>o,hy:()=>s});var n=a(1482),l=a.n(n);let r=process.env.JWT_SECRET;function o(e){return l().sign(e,r,{expiresIn:"7d"})}function i(e){try{return l().verify(e,r)}catch{return null}}function s(e){let t=e.headers.get("authorization");return t&&t.startsWith("Bearer ")?t.substring(7):null}function u(e){let t=s(e);return t?i(t):null}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[276,972,500,482],()=>a(4709));module.exports=n})();