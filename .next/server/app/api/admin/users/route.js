"use strict";(()=>{var e={};e.id=628,e.ids=[628],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},8678:e=>{e.exports=import("pg")},963:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>c,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var s=t(9303),n=t(8716),i=t(670),u=t(5842),o=e([u]);u=(o.then?(await o)():o)[0];let p=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/users/route",pathname:"/api/admin/users",filename:"route",bundlePath:"app/api/admin/users/route"},resolvedPagePath:"C:\\dev\\Second\\app\\api\\admin\\users\\route.ts",nextConfigOutput:"standalone",userland:u}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:m}=p,h="/api/admin/users/route";function c(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}a()}catch(e){a(e)}})},5842:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{GET:()=>p});var s=t(7070),n=t(8678),i=t(1482),u=t.n(i),o=e([n]);let d=new(n=(o.then?(await o)():o)[0]).Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});async function c(e){try{let r=u().verify(e,process.env.JWT_SECRET||"your-secret-key");if("admin"!==r.role)return null;return r}catch(e){return null}}async function p(e){try{let r=e.headers.get("authorization");if(!r||!r.startsWith("Bearer "))return s.NextResponse.json({success:!1,message:"Authorization header required"},{status:401});let t=r.substring(7);if(!await c(t))return s.NextResponse.json({success:!1,message:"Admin access required"},{status:403});let a=await d.connect();try{let e=`
        SELECT 
          u.id,
          u.name,
          u.email,
          u.role,
          u.created_at,
          COUNT(a.id) as application_count
        FROM users u
        LEFT JOIN applications a ON u.id = a.user_id
        GROUP BY u.id, u.name, u.email, u.role, u.created_at
        ORDER BY u.created_at DESC
      `,r=(await a.query(e)).rows.map(e=>({id:e.id,name:e.name,email:e.email,role:e.role,createdAt:e.created_at,applicationCount:parseInt(e.application_count)}));return s.NextResponse.json({success:!0,data:r})}finally{a.release()}}catch(e){return console.error("Error fetching users:",e),s.NextResponse.json({success:!1,message:"Internal server error"},{status:500})}}a()}catch(e){a(e)}})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[276,972,482],()=>t(963));module.exports=a})();