"use strict";(()=>{var e={};e.id=829,e.ids=[829],e.modules={5890:e=>{e.exports=require("better-sqlite3")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},2048:e=>{e.exports=require("fs")},8216:e=>{e.exports=require("net")},9801:e=>{e.exports=require("os")},6119:e=>{e.exports=require("perf_hooks")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},6005:e=>{e.exports=require("node:crypto")},463:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>h,routeModule:()=>L,serverHooks:()=>A,staticGenerationAsyncStorage:()=>g});var n={};a.r(n),a.d(n,{GET:()=>N});var o=a(9303),r=a(8716),l=a(670),s=a(7070),i=a(6571),u=a(6596),c=a(4149),d=a(8937),p=a(5890),f=a.n(p),m=a(7327);let _=function(){try{return function(){let e=process.env.DATABASE_URL||`postgresql://${process.env.DB_USER}:${process.env.DB_PASSWORD}@${process.env.DB_HOST}:${process.env.DB_PORT||5432}/${process.env.DB_NAME}`,t=(0,d.Z)(e,{ssl:"true"===process.env.DB_SSL&&{rejectUnauthorized:!1},max:parseInt(process.env.DB_MAX_CONNECTIONS||"20"),idle_timeout:parseInt(process.env.DB_IDLE_TIMEOUT||"30000"),connect_timeout:parseInt(process.env.DB_CONNECTION_TIMEOUT||"5000"),prepare:!1});return(0,i.t)(t,{schema:m})}()}catch(e){return console.error("❌ Database connection failed:",e),console.warn("⚠️  Falling back to SQLite for production (not recommended)"),function(){let e=new(f())(process.env.DATABASE_PATH||"./dev.db");return e.pragma("journal_mode = WAL"),e.pragma("synchronous = NORMAL"),e.pragma("cache_size = 1000000"),e.pragma("foreign_keys = ON"),e.pragma("temp_store = MEMORY"),(0,u.t)(e,{schema:m})}()}}();async function y(){try{try{await _.execute((0,c.i6)`SELECT 1 as health_check`)}catch(e){await _.$client`SELECT 1 as health_check`}return{status:"healthy",timestamp:new Date().toISOString(),type:"postgresql"}}catch(e){return{status:"unhealthy",error:e instanceof Error?e.message:"Unknown error",timestamp:new Date().toISOString(),type:"postgresql"}}}async function N(e){try{let e=Date.now(),t=await y(),a={maxConnections:parseInt(process.env.DB_MAX_CONNECTIONS||"20"),idleTimeout:parseInt(process.env.DB_IDLE_TIMEOUT||"30000"),connectTimeout:parseInt(process.env.DB_CONNECTION_TIMEOUT||"5000"),ssl:"true"===process.env.DB_SSL,environment:"production"},n=function(){if("undefined"!=typeof process&&process.memoryUsage){let e=process.memoryUsage();return{used:Math.round(e.heapUsed/1024/1024),total:Math.round(e.heapTotal/1024/1024),percentage:Math.round(e.heapUsed/e.heapTotal*100)}}return{used:0,total:0,percentage:0}}(),o="undefined"!=typeof process&&process.uptime?Math.floor(process.uptime()):0,r="healthy";"unhealthy"===t.status?r="unhealthy":n.percentage>85&&(r="degraded");let l={status:r,timestamp:new Date().toISOString(),uptime:o,version:process.env.npm_package_version||"0.1.0",environment:"production",services:{database:{...t,...a},memory:n,disk:{available:!0}}},i=Date.now()-e;return s.NextResponse.json({...l,responseTime:`${i}ms`},{status:"healthy"===r?200:"degraded"===r?200:503,headers:{"Cache-Control":"no-cache, no-store, must-revalidate","Content-Type":"application/json"}})}catch(e){return console.error("Health check failed:",e),s.NextResponse.json({status:"unhealthy",timestamp:new Date().toISOString(),error:e instanceof Error?e.message:"Unknown health check error",environment:"production"},{status:503,headers:{"Cache-Control":"no-cache, no-store, must-revalidate","Content-Type":"application/json"}})}}let L=new o.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/health/route",pathname:"/api/health",filename:"route",bundlePath:"app/api/health/route"},resolvedPagePath:"C:\\dev\\Second\\app\\api\\health\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:A}=L,v="/api/health/route";function w(){return(0,l.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:g})}},7327:(e,t,a)=>{a.r(t),a.d(t,{applicationStatusEnum:()=>f,contactSubmissions:()=>T,documentServices:()=>A,fileUploads:()=>w,notifications:()=>B,paymentStatusEnum:()=>m,payments:()=>v,serviceTypeEnum:()=>_,travelBookings:()=>N,uaeJobApplications:()=>g,userRoleEnum:()=>p,users:()=>y,visaApplications:()=>L,workPermitApplications:()=>h});var n=a(5396),o=a(889),r=a(2140),l=a(8748),s=a(1575),i=a(1401),u=a(2941),c=a(3050),d=a(450);let p=(0,n.ys)("user_role",["admin","user","agent"]),f=(0,n.ys)("application_status",["pending","in_progress","approved","rejected","completed"]),m=(0,n.ys)("payment_status",["pending","processing","completed","failed","refunded"]),_=(0,n.ys)("service_type",["travel","visa","work_permit","document","uae_job"]),y=(0,o.af)("users",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,d.Mc)()),email:(0,r.fL)("email").unique().notNull(),password:(0,r.fL)("password"),name:(0,r.fL)("name").notNull(),phone:(0,r.fL)("phone"),role:p("role").default("user").notNull(),isVerified:(0,l.O7)("is_verified").default(!1),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow().notNull()}),N=(0,o.af)("travel_bookings",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,d.Mc)()),userId:(0,r.fL)("user_id").references(()=>y.id),bookingType:(0,i.L7)("booking_type",{length:50}).notNull(),departure:(0,r.fL)("departure"),destination:(0,r.fL)("destination"),departureDate:(0,s.AB)("departure_date"),returnDate:(0,s.AB)("return_date"),passengers:(0,u._L)("passengers").default(1),rooms:(0,u._L)("rooms").default(1),classType:(0,i.L7)("class_type",{length:20}),totalAmount:(0,c.gH)("total_amount",{precision:10,scale:2}),currency:(0,i.L7)("currency",{length:3}).default("AED"),status:f("status").default("pending").notNull(),specialRequests:(0,r.fL)("special_requests"),contactName:(0,r.fL)("contact_name").notNull(),contactEmail:(0,r.fL)("contact_email").notNull(),contactPhone:(0,r.fL)("contact_phone").notNull(),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow().notNull()}),L=(0,o.af)("visa_applications",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,d.Mc)()),userId:(0,r.fL)("user_id").references(()=>y.id),visaType:(0,i.L7)("visa_type",{length:50}).notNull(),nationality:(0,r.fL)("nationality").notNull(),passportNumber:(0,r.fL)("passport_number").notNull(),passportExpiry:(0,s.AB)("passport_expiry").notNull(),purposeOfVisit:(0,i.L7)("purpose_of_visit",{length:50}).notNull(),intendedArrival:(0,s.AB)("intended_arrival"),duration:(0,u._L)("duration"),totalAmount:(0,c.gH)("total_amount",{precision:10,scale:2}),currency:(0,i.L7)("currency",{length:3}).default("AED"),status:f("status").default("pending").notNull(),processingDays:(0,u._L)("processing_days"),additionalNotes:(0,r.fL)("additional_notes"),contactName:(0,r.fL)("contact_name").notNull(),contactEmail:(0,r.fL)("contact_email").notNull(),contactPhone:(0,r.fL)("contact_phone").notNull(),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow().notNull()}),h=(0,o.af)("work_permit_applications",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,d.Mc)()),userId:(0,r.fL)("user_id").references(()=>y.id),country:(0,i.L7)("country",{length:50}).notNull(),jobTitle:(0,r.fL)("job_title").notNull(),company:(0,r.fL)("company"),salary:(0,c.gH)("salary",{precision:10,scale:2}),currency:(0,i.L7)("currency",{length:3}).default("EUR"),location:(0,r.fL)("location"),workExperience:(0,r.fL)("work_experience"),education:(0,r.fL)("education"),languageSkills:(0,r.fL)("language_skills"),status:f("status").default("pending").notNull(),processingWeeks:(0,u._L)("processing_weeks"),accommodationIncluded:(0,l.O7)("accommodation_included").default(!1),transportIncluded:(0,l.O7)("transport_included").default(!1),contactName:(0,r.fL)("contact_name").notNull(),contactEmail:(0,r.fL)("contact_email").notNull(),contactPhone:(0,r.fL)("contact_phone").notNull(),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow().notNull()}),g=(0,o.af)("uae_job_applications",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,d.Mc)()),userId:(0,r.fL)("user_id").references(()=>y.id),industry:(0,i.L7)("industry",{length:50}).notNull(),jobTitle:(0,r.fL)("job_title").notNull(),experience:(0,i.L7)("experience",{length:20}),expectedSalary:(0,c.gH)("expected_salary",{precision:10,scale:2}),currency:(0,i.L7)("currency",{length:3}).default("AED"),availability:(0,s.AB)("availability"),visaStatus:(0,i.L7)("visa_status",{length:50}),resume:(0,r.fL)("resume_url"),status:f("status").default("pending").notNull(),contactName:(0,r.fL)("contact_name").notNull(),contactEmail:(0,r.fL)("contact_email").notNull(),contactPhone:(0,r.fL)("contact_phone").notNull(),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow().notNull()}),A=(0,o.af)("document_services",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,d.Mc)()),userId:(0,r.fL)("user_id").references(()=>y.id),serviceType:(0,i.L7)("service_type",{length:50}).notNull(),documentType:(0,r.fL)("document_type").notNull(),language:(0,i.L7)("language",{length:20}),urgency:(0,i.L7)("urgency",{length:20}),quantity:(0,u._L)("quantity").default(1),totalAmount:(0,c.gH)("total_amount",{precision:10,scale:2}),currency:(0,i.L7)("currency",{length:3}).default("AED"),status:f("status").default("pending").notNull(),deliveryMethod:(0,i.L7)("delivery_method",{length:20}),specialInstructions:(0,r.fL)("special_instructions"),contactName:(0,r.fL)("contact_name").notNull(),contactEmail:(0,r.fL)("contact_email").notNull(),contactPhone:(0,r.fL)("contact_phone").notNull(),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow().notNull()}),v=(0,o.af)("payments",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,d.Mc)()),userId:(0,r.fL)("user_id").references(()=>y.id),applicationId:(0,r.fL)("application_id").notNull(),applicationType:_("application_type").notNull(),amount:(0,c.gH)("amount",{precision:10,scale:2}).notNull(),currency:(0,i.L7)("currency",{length:3}).notNull(),paymentMethod:(0,i.L7)("payment_method",{length:20}).notNull(),paymentGatewayId:(0,r.fL)("payment_gateway_id"),status:m("status").default("pending").notNull(),paidAt:(0,s.AB)("paid_at"),refundedAt:(0,s.AB)("refunded_at"),refundAmount:(0,c.gH)("refund_amount",{precision:10,scale:2}),metadata:(0,r.fL)("metadata"),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow().notNull()}),w=(0,o.af)("file_uploads",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,d.Mc)()),userId:(0,r.fL)("user_id").references(()=>y.id),applicationId:(0,r.fL)("application_id").notNull(),applicationType:_("application_type").notNull(),fileName:(0,r.fL)("file_name").notNull(),originalName:(0,r.fL)("original_name").notNull(),fileSize:(0,u._L)("file_size").notNull(),mimeType:(0,r.fL)("mime_type").notNull(),fileUrl:(0,r.fL)("file_url").notNull(),documentType:(0,i.L7)("document_type",{length:50}),createdAt:(0,s.AB)("created_at").defaultNow().notNull()}),B=(0,o.af)("notifications",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,d.Mc)()),userId:(0,r.fL)("user_id").references(()=>y.id),title:(0,r.fL)("title").notNull(),message:(0,r.fL)("message").notNull(),type:(0,i.L7)("type",{length:20}).notNull(),applicationId:(0,r.fL)("application_id"),isRead:(0,l.O7)("is_read").default(!1),createdAt:(0,s.AB)("created_at").defaultNow().notNull()}),T=(0,o.af)("contact_submissions",{id:(0,r.fL)("id").primaryKey().$defaultFn(()=>(0,d.Mc)()),name:(0,r.fL)("name").notNull(),email:(0,r.fL)("email").notNull(),phone:(0,r.fL)("phone"),subject:(0,r.fL)("subject").notNull(),message:(0,r.fL)("message").notNull(),service:(0,i.L7)("service",{length:50}),isReplied:(0,l.O7)("is_replied").default(!1),createdAt:(0,s.AB)("created_at").defaultNow().notNull()})}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[276,972,500],()=>a(463));module.exports=n})();