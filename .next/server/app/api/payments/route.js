"use strict";(()=>{var e={};e.id=649,e.ids=[649],e.modules={5890:e=>{e.exports=require("better-sqlite3")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2048:e=>{e.exports=require("fs")},8216:e=>{e.exports=require("net")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6119:e=>{e.exports=require("perf_hooks")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},1764:e=>{e.exports=require("util")},6005:e=>{e.exports=require("node:crypto")},4487:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>I,patchFetch:()=>R,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>v,staticGenerationAsyncStorage:()=>q});var r={};s.r(r),s.d(r,{GET:()=>h,POST:()=>x});var n=s(9303),a=s(8716),o=s(670),u=s(7070),i=s(5592),p=s(8695),c=s(7745),l=s(1445),d=s(5748),m=s(7327);let y=new i.t;async function x(e){try{let t=(0,p.hy)(e);if(!t)return u.NextResponse.json({success:!1,message:"Authentication required"},{status:401});let s=(0,p.WX)(t);if(!s)return u.NextResponse.json({success:!1,message:"Invalid token"},{status:401});let r=await e.json(),n={applicationId:r.applicationId,amount:r.amount,currency:r.currency||"AED",paymentMethod:r.paymentMethod,customerInfo:{name:r.customerInfo?.name||s.name||"Unknown",email:r.customerInfo?.email||s.email,phone:r.customerInfo?.phone},billingAddress:r.billingAddress};if(!n.applicationId||!n.amount||!n.paymentMethod)return u.NextResponse.json({success:!1,message:"Missing required fields: applicationId, amount, paymentMethod"},{status:400});if(!["paytabs","stripe","paypal"].includes(n.paymentMethod))return u.NextResponse.json({success:!1,message:"Invalid payment method. Supported: paytabs, stripe, paypal"},{status:400});let a=await y.processPayment(n);return u.NextResponse.json(a,{status:a.success?200:400})}catch(e){return console.error("Payment API error:",e),u.NextResponse.json({success:!1,message:"Internal server error"},{status:500})}}async function h(e){try{let t=(0,p.hy)(e);if(!t)return u.NextResponse.json({success:!1,message:"Authentication required"},{status:401});let s=(0,p.WX)(t);if(!s)return u.NextResponse.json({success:!1,message:"Invalid token"},{status:401});let{searchParams:r}=new URL(e.url),n=r.get("id");if(n){let e=await y.getPaymentStatus(n);return u.NextResponse.json(e)}{let e=await d.db.query.payments?.findMany({where:c.eq(m.payments.userId,s.userId),orderBy:[l.C(m.payments.createdAt)]});return u.NextResponse.json({success:!0,data:e||[]})}}catch(e){return console.error("Get payments API error:",e),u.NextResponse.json({success:!1,message:"Internal server error"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/payments/route",pathname:"/api/payments",filename:"route",bundlePath:"app/api/payments/route"},resolvedPagePath:"C:\\dev\\Second\\app\\api\\payments\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:q,serverHooks:v}=f,I="/api/payments/route";function R(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:q})}},8695:(e,t,s)=>{s.d(t,{AY:()=>p,WX:()=>u,fT:()=>o,hy:()=>i});var r=s(1482),n=s.n(r);let a=process.env.JWT_SECRET;function o(e){return n().sign(e,a,{expiresIn:"7d"})}function u(e){try{return n().verify(e,a)}catch{return null}}function i(e){let t=e.headers.get("authorization");return t&&t.startsWith("Bearer ")?t.substring(7):null}function p(e){let t=i(e);return t?u(t):null}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972,500,482,727],()=>s(4487));module.exports=r})();