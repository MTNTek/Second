"use strict";(()=>{var e={};e.id=543,e.ids=[543],e.modules={5890:e=>{e.exports=require("better-sqlite3")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},2048:e=>{e.exports=require("fs")},8216:e=>{e.exports=require("net")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6119:e=>{e.exports=require("perf_hooks")},6162:e=>{e.exports=require("stream")},2452:e=>{e.exports=require("tls")},6005:e=>{e.exports=require("node:crypto")},6588:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>x,routeModule:()=>y,serverHooks:()=>q,staticGenerationAsyncStorage:()=>b});var a={};r.r(a),r.d(a,{POST:()=>m});var s=r(9303),o=r(8716),n=r(670),p=r(7070),u=r(5592),i=r(5748),c=r(7327),l=r(7745);let d=new u.t;async function m(e){try{let t=await e.json(),{payment_token:r,tran_ref:a,cart_id:s,cart_amount:o,cart_currency:n,tran_type:u,resp_status:m,resp_code:y,resp_message:x,customer_details:b}=t;if(!await i.db.query.payments?.findFirst({where:l.eq(c.payments.id,r)}))return console.error("Payment not found:",r),p.NextResponse.json({success:!1,message:"Payment not found"},{status:404});let q="failed";return"A"===m&&"100"===y?q="completed":"P"===m&&(q="processing"),await d.updatePaymentStatus(r,q,{tran_ref:a,resp_status:m,resp_code:y,resp_message:x,callback_data:t,updated_at:new Date().toISOString()}),p.NextResponse.json({success:!0,message:"Callback processed successfully",status:q})}catch(e){return console.error("PayTabs callback error:",e),p.NextResponse.json({success:!1,message:"Callback processing failed"},{status:500})}}let y=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/payments/paytabs/callback/route",pathname:"/api/payments/paytabs/callback",filename:"route",bundlePath:"app/api/payments/paytabs/callback/route"},resolvedPagePath:"C:\\dev\\Second\\app\\api\\payments\\paytabs\\callback\\route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:b,serverHooks:q}=y,f="/api/payments/paytabs/callback/route";function g(){return(0,n.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:b})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972,500,727],()=>r(6588));module.exports=a})();